{% extends "base.html" %}
{% block content %}
<div class="row mb-3">
  <div class="col-md-6">
    <h2><i class="bi bi-bell"></i> Notifications</h2>
  </div>
  <div class="col-md-6 text-end">
    <form
      method="POST"
      action="{{ url_for('notifications_read_all') }}"
      style="display: inline"
    >
      <button type="submit" class="btn btn-outline-warning">
        <i class="bi bi-check-all"></i> Mark All as Read
      </button>
    </form>
  </div>
</div>

{% if pagination.items %}
<div class="list-group">
  {% for notification in pagination.items %}
  <div
    class="list-group-item {% if not notification.is_read %}bg-dark border-warning{% else %}bg-dark border-secondary{% endif %} text-white"
    style="border-width: 1px;"
  >
    <div class="d-flex w-100 justify-content-between align-items-start">
      <div class="flex-grow-1">
        <h6 class="mb-1">
          {% if notification.type == 'low_stock' %}
          <i class="bi bi-exclamation-triangle" style="color:#EF4648"></i>
          {% elif notification.type == 'new_product' %}
          <i class="bi bi-box" style="color:#F36F38"></i>
          {% else %}
          <i class="bi bi-info-circle" style="color:#F99E4C"></i>
          {% endif %}
          {{ notification.title }}
        </h6>
        <p class="mb-1">{{ notification.message }}</p>
        <small class="text-muted"
          >{{ notification.created_at.strftime('%B %d, %Y at %I:%M %p') }}</small
        >
      </div>
      <div class="ms-3">
        {% if not notification.is_read %}
        <button
          class="btn btn-sm btn-outline-warning"
          onclick="markAsRead({{ notification.id }})"
        >
          <i class="bi bi-check"></i>
        </button>
        {% endif %}
        {% if notification.link %}
        <a
          href="{{ notification.link }}"
          class="btn btn-sm btn-outline-secondary"
        >
          <i class="bi bi-arrow-right"></i>
        </a>
        {% endif %}
      </div>
    </div>
  </div>
  {% endfor %}
</div>

<!-- Pagination -->
{% if pagination.pages > 1 %}
<nav class="mt-3">
  <ul class="pagination justify-content-center">
    {% if pagination.has_prev %}
    <li class="page-item">
      <a
        class="page-link"
        href="{{ url_for('notifications', page=pagination.prev_num) }}"
        style="background-color:#2B1E2F; color:#F99E4C; border-color:#582841;"
      >Previous</a>
    </li>
    {% endif %}

    <li class="page-item active">
      <span class="page-link" style="background-color:#F36F38; color:#fff;">
        {{ pagination.page }} / {{ pagination.pages }}
      </span>
    </li>

    {% if pagination.has_next %}
    <li class="page-item">
      <a
        class="page-link"
        href="{{ url_for('notifications', page=pagination.next_num) }}"
        style="background-color:#2B1E2F; color:#F99E4C; border-color:#582841;"
      >Next</a>
    </li>
    {% endif %}
  </ul>
</nav>
{% endif %}
{% else %}
<div class="alert text-center" style="background-color:#2B1E2F; color:#F99E4C;">
  <i class="bi bi-bell-slash" style="font-size: 3rem;"></i>
  <p class="mt-2">No notifications yet!</p>
</div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
  function markAsRead(notifId) {
    fetch(`/notifications/${notifId}/read`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
    })
      .then((response) => response.json())
      .then((data) => {
        if (data.success) {
          location.reload();
        }
      });
  }
</script>
{% endblock %}
